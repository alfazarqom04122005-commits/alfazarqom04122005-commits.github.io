<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* Animasi pulse untuk status terakhir */
  .pulse {
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%,100%{transform: scale(1);opacity:1;}
    50%{transform: scale(1.4);opacity:0.6;}
  }
</style>
</head>
<body class="bg-gray-100 p-4">

<div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-md">
  <h2 class="text-2xl font-bold mb-4 text-center">Tracking Resi J&T Cargo</h2>

  <form id="cekResiForm" class="flex flex-col gap-3 mb-6">
    <input type="text" id="nomorResi" name="nomorResi" 
           placeholder="Masukkan nomor resi" required
           class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <button type="submit"
            class="bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Cek Resi</button>
  </form>

  <!-- Progress bar modern -->
  <div id="progressBar" class="flex items-center justify-between mb-6 relative h-16"></div>

  <div id="hasilResi"></div>
</div>

<script>
const form = document.getElementById('cekResiForm');
const hasilDiv = document.getElementById('hasilResi');
const progressDiv = document.getElementById('progressBar');

const statusSteps = ['PICK UP', 'DALAM PERJALANAN', 'DIKIRIM', 'TANDA TERIMA'];

form.addEventListener('submit', async function(e) {
  e.preventDefault();
  const nomorResi = document.getElementById('nomorResi').value.trim();
  hasilDiv.innerHTML = `<p class="text-gray-500">Sedang mencari...</p>`;
  progressDiv.innerHTML = '';

  try {
    const res = await fetch('https://opensheet.elk.sh/1j3Sq13q0g4qtu3n4_HNLOO6FYCyBpToZU7iAIo0yZvM/jntcargo');
    const data = await res.json();
    const hasil = data.filter(item => item.NoResi === nomorResi);

    if (hasil.length === 0) {
      hasilDiv.innerHTML = `<p class="text-red-500 font-semibold">Nomor resi tidak ditemukan.</p>`;
      return;
    }

    // Ambil status terakhir
    hasil.sort((a,b) => new Date(a.TanggalWaktu) - new Date(b.TanggalWaktu));
    const lastStatus = hasil[hasil.length -1].Status.toUpperCase();

    // Buat progress bar modern
    statusSteps.forEach((step,index)=>{
      const isDone = statusSteps.indexOf(lastStatus) >= index;
      const isLastDone = statusSteps.indexOf(lastStatus) === index;
      progressDiv.innerHTML += `
        <div class="flex items-center flex-1 relative">
          <div class="flex flex-col items-center z-10">
            <div class="w-10 h-10 rounded-full border-2 border-white ${isDone ? (isLastDone?'bg-green-500 pulse':'bg-green-500'):'bg-gray-300'} shadow-md"></div>
            <span class="text-xs mt-2 text-center font-semibold">${step}</span>
          </div>
          ${index < statusSteps.length -1 ? `
            <div class="absolute top-5 left-1/2 w-full h-1 -translate-x-1/2 ${isDone ? (isLastDone?'bg-green-500 pulse':'bg-green-500'):'bg-gray-300'} rounded-full"></div>` : ''}
        </div>
      `;
    });

    // Data paket & pengirim/penerima
    const item = hasil[0];
    let html = `
      <div class="grid grid-cols-2 gap-3 mb-6 text-sm">
        <p><span class="font-semibold">Metode Layanan:</span> ${item.MetodeLayanan}</p>
        <p><span class="font-semibold">Berat:</span> ${item.Berat_kg} kg</p>
        <p><span class="font-semibold">Waktu Pick Up:</span> ${item.WaktuPickUp}</p>
        <p><span class="font-semibold">Volume:</span> ${item.Volume_m3} mÂ³</p>
        <p><span class="font-semibold">Waktu Pengiriman:</span> ${item.WaktuPengiriman}</p>
        <p><span class="font-semibold">Jumlah Koli:</span> ${item.JumlahKoli}</p>
      </div>
      <div class="mb-6 text-sm">
        <p><span class="font-semibold">NO RESI:</span> ${item.NoResi}</p>
        <p><span class="font-semibold">ASURANSI:</span> Rp.${Number(item.Asuransi).toLocaleString()}</p>
        <p><span class="font-semibold">SPJ:</span> Rp.${Number(item.SPJ).toLocaleString()}</p>
        <p><span class="font-semibold">PENGIRIM:</span> ${item.PengirimNama}</p>
        <p><span class="font-semibold">Kota Pengirim:</span> ${item.PengirimKota}</p>
        <p><span class="font-semibold">No Telp:</span> ${item.PengirimNoTelp}</p>
        <p><span class="font-semibold">PENERIMA:</span> ${item.PenerimaNama}</p>
        <p><span class="font-semibold">Alamat:</span> ${item.PenerimaAlamat.replace(/\t/g, ', ')}</p>
        <p><span class="font-semibold">No Telp:</span> ${item.PenerimaNoTelp}</p>
      </div>
    `;

    // Timeline status
    html += `<div class="relative border-l-2 border-gray-300 ml-2">`;
    hasil.forEach((statusItem,index)=>{
      const isLast = index === hasil.length -1;
      html += `
        <div class="mb-6 ml-6 relative">
          <span class="absolute -left-4 top-1 w-4 h-4 rounded-full border-2 border-white ${isLast?'bg-green-500 pulse':'bg-blue-500'}"></span>
          <p class="font-semibold ${isLast?'text-green-600':''}">${statusItem.Status}</p>
          <p class="text-gray-700 text-sm">${statusItem.Detail}</p>
          <p class="text-gray-500 text-xs mt-1">${statusItem.Lokasi} | ${statusItem.TanggalWaktu}</p>
      `;
      if(statusItem['Status 2 Keterangan']){
        html += `
          <p class="text-gray-700 text-sm"><span class="font-semibold">Status2Keterangan:</span> ${statusItem['Status 2 Keterangan']}</p>
          <p class="text-gray-500 text-xs"><span class="font-semibold">Status2TanggalWaktu:</span> ${statusItem['Status 2 Tanggal & Waktu']}</p>
          <p class="text-gray-500 text-xs"><span class="font-semibold">Status2Lokasi:</span> ${statusItem['Status 2 Lokasi']}</p>
          <p class="text-gray-500 text-xs"><span class="font-semibold">Status2Detail:</span> ${statusItem['Status 2 Detail']}</p>
        `;
      }
      html += `</div>`;
    });
    html += `</div>`;

    hasilDiv.innerHTML = html;

  } catch(err){
    hasilDiv.innerHTML = `<p class="text-red-500 font-semibold">Terjadi kesalahan saat mengambil data.</p>`;
    console.error(err);
  }
});
</script>

</body>
</html>
